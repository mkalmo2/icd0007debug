#!/usr/bin/env php
<?php

$opts = getopt('t:f:v:', ['teamcity:', 'filter:']);

$testPath = $opts['teamcity'] ?? null;
$filter = $opts['filter'] ?? '';
$testName = getSelectedTestName($filter);

foreach ($argv as $arg) {
    if ($arg === '--version') {
        print '  Pest Testing Framework 3.0.6.' . PHP_EOL;
        exit;
    }
}

$cmd = sprintf("php %s --testToRun \"%s\"", $testPath, $testName);

exec($cmd, $output, $exitCode);

print join(PHP_EOL, $output);

function getSelectedTestName(string $filter): string {
    $str = str_replace('\\s', ' ', $filter);
    $str = preg_replace('/.*::/', '', $str);
    return preg_replace('/\(.*/', '', $str);
}